# DeepSeek API 集成指南

## 概述

本指南说明如何在Aurora情感疗愈AI助手中集成DeepSeek API，实现专业的AI对话功能。

## 功能特性

### 1. Aurora系统提示词
- **专业情感疗愈AI助手**：Aurora专门设计用于情感支持和疗愈
- **共情优先**：优先认可用户情绪，再处理具体问题
- **非指导性**：通过提问引导用户自己发现答案
- **安全边界**：鼓励用户寻求专业心理咨询师帮助

### 2. DeepSeek API集成
- **智能对话**：使用DeepSeek的强大语言模型
- **情感识别**：自动识别用户情感状态
- **JSON格式输出**：结构化响应，包含回复、情感标签和建议
- **错误处理**：完善的错误处理和重试机制

### 3. 用户体验
- **API密钥设置**：友好的密钥设置界面
- **备用模式**：无API密钥时的备用回复
- **对话历史**：保持对话上下文
- **实时状态**：显示API连接状态

## 文件结构

```
网站/
├── js/
│   ├── deepseek-api.js          # DeepSeek API集成模块
│   └── auth-manager.js           # 更新的认证管理器
├── dialogue.html                 # 更新的对话页面
├── test-deepseek.html           # 测试页面
└── DEEPSEEK_INTEGRATION_GUIDE.md # 本指南
```

## 使用方法

### 1. 获取DeepSeek API密钥

1. 访问 [DeepSeek平台](https://platform.deepseek.com/api_keys)
2. 注册或登录账户
3. 创建新的API密钥
4. 复制密钥（格式：`sk-...`）

### 2. 设置API密钥

#### 方法一：在对话页面设置
1. 打开 `dialogue.html`
2. 页面会显示API密钥设置提示
3. 输入您的DeepSeek API密钥
4. 点击"设置"按钮

#### 方法二：使用测试页面
1. 打开 `test-deepseek.html`
2. 在"API密钥设置"部分输入密钥
3. 点击"设置API密钥"
4. 点击"测试API密钥"验证

### 3. 开始对话

1. 设置API密钥后，进入对话页面
2. 在输入框中输入您的消息
3. Aurora会使用DeepSeek API生成专业的情感疗愈回复
4. 系统会显示情感标签和建议的下一步

## API响应格式

DeepSeek API返回的Aurora回复包含以下字段：

```json
{
  "response": "Aurora的主要回复内容",
  "emotional_label": "检测到的情感标签（如：焦虑、孤独、喜悦）",
  "suggested_next_step": "建议的后续问题或行动"
}
```

## 错误处理

### 1. API密钥错误
- 格式验证：密钥必须以`sk-`开头
- 有效性检查：测试API密钥是否有效

### 2. 网络错误
- 自动重试：最多重试3次
- 递增延迟：每次重试间隔递增
- 备用回复：API失败时使用备用回复

### 3. 响应解析
- JSON解析：优先解析JSON格式响应
- 文本解析：JSON失败时使用文本解析
- 情感识别：自动识别情感关键词

## 测试功能

使用 `test-deepseek.html` 页面可以：

1. **设置和测试API密钥**
2. **发送测试消息**
3. **查看系统状态**
4. **显示对话历史**
5. **清除对话历史**

## 配置选项

### DeepSeek API配置
```javascript
// 在 deepseek-api.js 中
this.apiUrl = 'https://api.deepseek.com/v1/chat/completions';
this.model = 'deepseek-chat';
this.temperature = 0.7;
this.maxTokens = 1000;
```

### 对话历史配置
```javascript
// 保持最近10轮对话
this.maxHistoryLength = 10;
```

## 安全考虑

1. **API密钥保护**：
   - 密钥存储在内存中，不持久化
   - 页面刷新后需要重新设置

2. **数据隐私**：
   - 对话历史仅存储在本地
   - 不向第三方发送用户数据

3. **错误处理**：
   - 敏感错误信息不会暴露给用户
   - 完善的异常捕获和处理

## 故障排除

### 常见问题

1. **API密钥无效**
   - 检查密钥格式是否正确
   - 确认密钥是否有效且有足够额度

2. **网络连接问题**
   - 检查网络连接
   - 确认DeepSeek API服务状态

3. **响应格式错误**
   - 系统会自动使用备用解析方法
   - 检查控制台错误信息

### 调试方法

1. 打开浏览器开发者工具
2. 查看控制台日志
3. 使用测试页面验证功能
4. 检查网络请求状态

## 更新日志

### v1.0.0 (当前版本)
- ✅ 集成DeepSeek API
- ✅ 实现Aurora系统提示词
- ✅ 添加API密钥设置界面
- ✅ 完善错误处理机制
- ✅ 创建测试页面
- ✅ 支持对话历史管理

## 技术支持

如果您在使用过程中遇到问题，请：

1. 查看浏览器控制台错误信息
2. 使用测试页面验证功能
3. 检查API密钥有效性
4. 确认网络连接状态

## 未来计划

- [ ] 支持更多AI模型
- [ ] 添加语音交互功能
- [ ] 实现多语言支持
- [ ] 优化响应速度
- [ ] 添加更多情感分析功能
