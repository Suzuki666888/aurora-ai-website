<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¹è¯è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .debug-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #444;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #2d5a2d; }
        .error { background: #5a2d2d; }
        .warning { background: #5a5a2d; }
        .info { background: #2d2d5a; }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        textarea {
            width: 100%;
            height: 100px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 5px;
        }
        .response {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Auroraå¯¹è¯è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-section">
        <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
        <div id="status-checks"></div>
        <button onclick="runStatusChecks()">ğŸ”„ é‡æ–°æ£€æŸ¥çŠ¶æ€</button>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ§ª APIè¿æ¥æµ‹è¯•</h2>
        <button onclick="testDeepSeekAPI()">æµ‹è¯•DeepSeek APIè¿æ¥</button>
        <button onclick="testLocalResponse()">æµ‹è¯•æœ¬åœ°æ™ºèƒ½å›å¤</button>
        <div id="api-test-results"></div>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ’¬ å¯¹è¯æµ‹è¯•</h2>
        <textarea id="test-message" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯...">ä½ å¥½ï¼Œæˆ‘æœ‰ç‚¹ç„¦è™‘</textarea>
        <br>
        <button onclick="testDialogue()">å‘é€æµ‹è¯•æ¶ˆæ¯</button>
        <div id="dialogue-results"></div>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ“ è¯¦ç»†æ—¥å¿—</h2>
        <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        <div id="detailed-logs"></div>
    </div>

    <script src="js/deepseek-api.js"></script>
    <script>
        let logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push({ message: logEntry, type });
            console.log(logEntry);
            updateLogDisplay();
        }
        
        function updateLogDisplay() {
            const logContainer = document.getElementById('detailed-logs');
            logContainer.innerHTML = logs.map(log => 
                `<div class="status ${log.type}">${log.message}</div>`
            ).join('');
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLogs() {
            logs = [];
            updateLogDisplay();
        }
        
        function addStatusCheck(title, status, details = '') {
            const container = document.getElementById('status-checks');
            const statusClass = status ? 'success' : 'error';
            const statusText = status ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸';
            container.innerHTML += `
                <div class="status ${statusClass}">
                    <strong>${title}:</strong> ${statusText}
                    ${details ? `<br><small>${details}</small>` : ''}
                </div>
            `;
        }
        
        function runStatusChecks() {
            log('å¼€å§‹ç³»ç»ŸçŠ¶æ€æ£€æŸ¥...');
            document.getElementById('status-checks').innerHTML = '';
            
            // æ£€æŸ¥DeepSeek APIæ˜¯å¦åŠ è½½
            const apiLoaded = typeof window.deepSeekAPI !== 'undefined';
            addStatusCheck('DeepSeek APIåŠ è½½', apiLoaded, 
                apiLoaded ? 'APIç±»å·²æ­£ç¡®åŠ è½½' : 'APIç±»æœªåŠ è½½');
            
            if (apiLoaded) {
                // æ£€æŸ¥APIå¯†é’¥
                const apiKeyValid = window.deepSeekAPI.isApiKeyValid();
                addStatusCheck('APIå¯†é’¥é…ç½®', apiKeyValid,
                    apiKeyValid ? 'APIå¯†é’¥æ ¼å¼æ­£ç¡®' : 'APIå¯†é’¥æœªé…ç½®æˆ–æ ¼å¼é”™è¯¯');
                
                // æ£€æŸ¥ç½‘ç»œè¿æ¥
                const online = window.deepSeekAPI.isOnline();
                addStatusCheck('ç½‘ç»œè¿æ¥', online,
                    online ? 'ç½‘ç»œè¿æ¥æ­£å¸¸' : 'ç½‘ç»œè¿æ¥å¼‚å¸¸');
                
                // æ£€æŸ¥APIé…ç½®
                const apiKey = window.deepSeekAPI.apiKey;
                const apiUrl = window.deepSeekAPI.apiUrl;
                addStatusCheck('APIé…ç½®', !!(apiKey && apiUrl),
                    `å¯†é’¥: ${apiKey ? 'å·²é…ç½®' : 'æœªé…ç½®'}, URL: ${apiUrl || 'æœªé…ç½®'}`);
                
                log(`APIå¯†é’¥: ${apiKey ? 'å·²é…ç½®' : 'æœªé…ç½®'}`);
                log(`API URL: ${apiUrl || 'æœªé…ç½®'}`);
                log(`ç½‘ç»œçŠ¶æ€: ${online ? 'åœ¨çº¿' : 'ç¦»çº¿'}`);
            }
        }
        
        async function testDeepSeekAPI() {
            log('å¼€å§‹æµ‹è¯•DeepSeek APIè¿æ¥...');
            const resultsContainer = document.getElementById('api-test-results');
            resultsContainer.innerHTML = '<div class="status info">æ­£åœ¨æµ‹è¯•APIè¿æ¥...</div>';
            
            try {
                if (!window.deepSeekAPI) {
                    throw new Error('DeepSeek APIæœªåŠ è½½');
                }
                
                const testMessage = 'ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿æ¥æµ‹è¯•';
                log(`å‘é€æµ‹è¯•æ¶ˆæ¯: ${testMessage}`);
                
                const response = await window.deepSeekAPI.sendMessage(testMessage, 'test_session');
                log(`APIå“åº”æˆåŠŸ: ${response.substring(0, 100)}...`);
                
                resultsContainer.innerHTML = `
                    <div class="status success">âœ… APIè¿æ¥æˆåŠŸ</div>
                    <div class="response">${response}</div>
                `;
                
            } catch (error) {
                log(`APIè¿æ¥å¤±è´¥: ${error.message}`, 'error');
                resultsContainer.innerHTML = `
                    <div class="status error">âŒ APIè¿æ¥å¤±è´¥</div>
                    <div class="status error">é”™è¯¯: ${error.message}</div>
                `;
            }
        }
        
        function testLocalResponse() {
            log('æµ‹è¯•æœ¬åœ°æ™ºèƒ½å›å¤...');
            const resultsContainer = document.getElementById('api-test-results');
            
            try {
                if (!window.deepSeekAPI) {
                    throw new Error('DeepSeek APIæœªåŠ è½½');
                }
                
                const testMessage = 'æˆ‘æœ‰ç‚¹ç„¦è™‘';
                log(`æµ‹è¯•æ¶ˆæ¯: ${testMessage}`);
                
                const response = window.deepSeekAPI.getLocalIntelligentResponse(testMessage);
                log(`æœ¬åœ°å›å¤é•¿åº¦: ${response.length} å­—ç¬¦`);
                
                resultsContainer.innerHTML = `
                    <div class="status success">âœ… æœ¬åœ°å›å¤æ­£å¸¸</div>
                    <div class="response">${response}</div>
                `;
                
            } catch (error) {
                log(`æœ¬åœ°å›å¤å¤±è´¥: ${error.message}`, 'error');
                resultsContainer.innerHTML = `
                    <div class="status error">âŒ æœ¬åœ°å›å¤å¤±è´¥</div>
                    <div class="status error">é”™è¯¯: ${error.message}</div>
                `;
            }
        }
        
        async function testDialogue() {
            log('å¼€å§‹å¯¹è¯æµ‹è¯•...');
            const message = document.getElementById('test-message').value;
            const resultsContainer = document.getElementById('dialogue-results');
            
            if (!message.trim()) {
                log('æµ‹è¯•æ¶ˆæ¯ä¸ºç©º', 'warning');
                return;
            }
            
            resultsContainer.innerHTML = '<div class="status info">æ­£åœ¨å¤„ç†å¯¹è¯...</div>';
            
            try {
                // æ¨¡æ‹Ÿdialogue.htmlä¸­çš„callAIæ–¹æ³•
                log(`ç”¨æˆ·æ¶ˆæ¯: ${message}`);
                
                if (window.deepSeekAPI) {
                    log('DeepSeek APIçŠ¶æ€æ£€æŸ¥...');
                    log(`APIå¯†é’¥çŠ¶æ€: ${window.deepSeekAPI.isApiKeyValid()}`);
                    log(`ç½‘ç»œçŠ¶æ€: ${window.deepSeekAPI.isOnline()}`);
                    
                    if (window.deepSeekAPI.isApiKeyValid() && window.deepSeekAPI.isOnline()) {
                        log('ä½¿ç”¨DeepSeek APIè¿›è¡Œå¯¹è¯...');
                        const response = await window.deepSeekAPI.sendMessage(message, 'test_session');
                        log(`DeepSeek APIå“åº”é•¿åº¦: ${response.length} å­—ç¬¦`);
                        
                        resultsContainer.innerHTML = `
                            <div class="status success">âœ… ä½¿ç”¨DeepSeek API</div>
                            <div class="response">${response}</div>
                        `;
                    } else {
                        log('DeepSeek APIä¸å¯ç”¨ï¼Œä½¿ç”¨æœ¬åœ°æ™ºèƒ½å›å¤');
                        const response = await window.deepSeekAPI.getLocalIntelligentResponse(message);
                        log(`æœ¬åœ°æ™ºèƒ½å›å¤é•¿åº¦: ${response.length} å­—ç¬¦`);
                        
                        resultsContainer.innerHTML = `
                            <div class="status warning">âš ï¸ ä½¿ç”¨æœ¬åœ°æ™ºèƒ½å›å¤</div>
                            <div class="response">${response}</div>
                        `;
                    }
                } else {
                    log('DeepSeek APIæœªåŠ è½½ï¼Œä½¿ç”¨å¤‡ç”¨å›å¤', 'error');
                    const responses = [
                        "æˆ‘ç†è§£ä½ çš„æ„Ÿå—ï¼Œè®©æˆ‘ä¸ºä½ è¯¦ç»†åˆ†æä¸€ä¸‹ã€‚",
                        "è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼Œæˆ‘æ¥ä¸ºä½ æä¾›ä¸€äº›å»ºè®®ã€‚",
                        "æ ¹æ®ä½ æä¾›çš„ä¿¡æ¯ï¼Œæˆ‘çš„å»ºè®®æ˜¯...",
                        "æˆ‘æ˜ç™½ä½ çš„éœ€æ±‚ï¼Œè®©æˆ‘ä¸ºä½ æä¾›ä¸€äº›å¸®åŠ©ã€‚",
                        "æ„Ÿè°¢ä½ çš„åˆ†äº«ï¼Œæˆ‘æ¥ä¸ºä½ è¯¦ç»†è¯´æ˜ã€‚"
                    ];
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    
                    resultsContainer.innerHTML = `
                        <div class="status error">âŒ ä½¿ç”¨å¤‡ç”¨å›å¤</div>
                        <div class="response">${response}</div>
                    `;
                }
                
            } catch (error) {
                log(`å¯¹è¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                resultsContainer.innerHTML = `
                    <div class="status error">âŒ å¯¹è¯æµ‹è¯•å¤±è´¥</div>
                    <div class="status error">é”™è¯¯: ${error.message}</div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒçŠ¶æ€æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', () => {
            log('è°ƒè¯•é¡µé¢å·²åŠ è½½');
            runStatusChecks();
        });
    </script>
</body>
</html>
